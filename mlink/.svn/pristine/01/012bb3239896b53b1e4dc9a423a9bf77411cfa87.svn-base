<{include file="b_block_header.html"}>
<{include file="b_block_banner.html"}>
<div>
  <div class="container" style="margin-top:30px;">
    <div style="text-align:center;margin-bottom:30px;"><h1>Affiliate - History Domain</h1></div>
    <div class="row" style="padding:20px 0;">

      <div class="col-lg-12">
        <div class="panel panel-default">
          <div class="panel-heading">Search</div>
          <div class="panel-body" >
            <form id="form_tran_search">
            
              <input type="hidden" name="p" value="1" />
              <input type="hidden" name="type" value="<{$search.type}>" />

              <div class="col-lg-10 form-inline">
                History Date:
                <div class="form-group">
                  <input type="text" name="his_from" class="form-control datepicker" id="his_from" value="<{$search.his_from}>" placeholder="History from">
                </div>
                <div class="form-group">
                  <input type="text" name="his_to" class="form-control datepicker" id="his_to" value="<{$search.his_to}>" placeholder="History to">
                </div>
                <div class="form-group" style="position:relative;">
                  <input type="text" name="pid" class="form-control tip" id="pid" value="<{$search.pid}>" placeholder="site" data-type="tip_publisher">
                </div>
                <div class="form-group" style="position:relative;">
                  <input type="text" name="domain" class="form-control" id="domain" value="<{$search.domain}>" placeholder="domain" data-type="tip_publisher">
                </div>
                <div class="form-group" style="position:relative;">
                  <a id="excel" style="cursor:pointer" >Export Excel</a>
                </div>
              </div>

              <div class="col-lg-2">
                <div class="form-group">
                  <input type="submit" class="btn  btn-primary " value="Search">
                </div>
              </div>

              <div class="col-lg-12 form-inline">
                Now Date:
                <div class="form-group">
                  <input type="text" name="now_from" class="form-control datepicker" id="now_from" value="<{$search.now_from}>" placeholder="Now from">
                </div>
                <div class="form-group">
                  <input type="text" name="now_to" class="form-control datepicker" id="now_to" value="<{$search.now_to}>" placeholder="Now to">
                </div>


				<div class="form-group">
                <select class="form-control" name="orderby" id="orderby" >
                    <option value="">OrderBy</option>
                    <option value="ordnumhis" <{if $search.orderby == 'ordnumhis'}>selected<{/if}>>OrderNum-his</option>
                    <option value="ordnumnow" <{if $search.orderby == 'ordnumnow'}>selected<{/if}>>OrderNum-now</option>
                    <option value="ordnumdiff" <{if $search.orderby == 'ordnumdiff'}>selected<{/if}>>OrderNum-diff</option>
                    <option value="ordnumchg" <{if $search.orderby == 'ordnumchg'}>selected<{/if}>>OrderNum-change</option>
                    <option value="ordsalhis" <{if $search.orderby == 'ordsalhis'}>selected<{/if}>>OrderSales-his</option>
                    <option value="ordsalnow" <{if $search.orderby == 'ordsalnow'}>selected<{/if}>>OrderSales-now</option>
                    <option value="ordsaldiff" <{if $search.orderby == 'ordsaldiff'}>selected<{/if}>>OrderSales-diff</option>
                    <option value="ordsalchg" <{if $search.orderby == 'ordsalchg'}>selected<{/if}>>OrderSales-change</option>
                    <option value="ordcomhis" <{if $search.orderby == 'ordcomhis'}>selected<{/if}>>OrderCommission-his</option>
                    <option value="ordcomnow" <{if $search.orderby == 'ordcomnow'}>selected<{/if}>>OrderCommission-now</option>
                    <option value="ordcomdiff" <{if $search.orderby == 'ordcomdiff'}>selected<{/if}>>OrderCommission-diff</option>
                    <option value="ordcomchg" <{if $search.orderby == 'ordcomchg'}>selected<{/if}>>OrderCommission-change</option>
                    <option value="ordcrhis" <{if $search.orderby == 'ordcrhis'}>selected<{/if}>>OrderCr-his</option>
                    <option value="ordcrnow" <{if $search.orderby == 'ordcrnow'}>selected<{/if}>>OrderCr-now</option>
                    <option value="ordcrdiff" <{if $search.orderby == 'ordcrdiff'}>selected<{/if}>>OrderCr-diff</option>
                    <option value="ordcrchg" <{if $search.orderby == 'ordcrchg'}>selected<{/if}>>OrderCr-change</option>
                    <option value="ordclihis" <{if $search.orderby == 'ordclihis'}>selected<{/if}>>OrderClick-his</option>
                    <option value="ordclinow" <{if $search.orderby == 'ordclinow'}>selected<{/if}>>OrderClick-now</option>
                    <option value="ordclidiff" <{if $search.orderby == 'ordclidiff'}>selected<{/if}>>OrderClick-diff</option>
                    <option value="ordclichg" <{if $search.orderby == 'ordclichg'}>selected<{/if}>>OrderClick-change</option>
				</select>
				</div>
				<div class="form-group">
			    <select class="form-control" name="order" id="order" >
                    <option value="descend" <{if $search.order == 'descend'}>selected<{/if}>>Descending</option>
                    <option value="ascend" <{if $search.order == 'ascend'}>selected<{/if}>>Ascending</option>
				</select>
				</div>
                <div class="form-group">
                  <input type="text" name="minorder" class="form-control" id="minorder" value="<{$search.minorder}>" placeholder="min history order num">
                </div>
               
                <a id="colume" style="cursor:pointer">Colume Choose</a>
             
              </div>
 			 </form>
           
            <div id="colume_list"  style="display:none">
             <div class="col-lg-12 form-inline">
             	Order Num:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
             	<div class="form-group">
             	<label class="checkbox">
             	<{assign var="origin_colarr" value=$colarr|json_decode}>
             	  History:
                  <input type="checkbox" name="num[]" value="num_his" <{if $href_change eq "no" }>checked<{elseif "num_his"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                <div class="form-group">
                <label class="checkbox">
             	  Now:
                  <input type="checkbox" name="num[]" value="num_now" <{if $href_change eq "no" }>checked<{elseif "num_now"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                 <div class="form-group">
                 <label class="checkbox">
             	  Diff:
                  <input type="checkbox" name="num[]" value="num_diff" <{if $href_change eq "no" }>checked<{elseif "num_diff"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                 <div class="form-group">
                 <label class="checkbox">
             	  Change:
                  <input type="checkbox" name="num[]" value="num_change" <{if $href_change eq "no" }>checked<{elseif "num_change"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                <div class="form-group">
                 <label class="checkbox">
             	  Select All:
                  <input type="checkbox" id="all_num">
                  </label>
                </div>
             </div>
          
              <div class="col-lg-12 form-inline">
             	Order Sale:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
             	<div class="form-group">
             	<label class="checkbox">
             	  History:
                  <input type="checkbox" name="sale[]" value="sale_his" <{if $href_change eq "no" }>checked<{elseif "sale_his"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                <div class="form-group">
                <label class="checkbox">
             	  Now:
                  <input type="checkbox" name="sale[]" value="sale_now" <{if $href_change eq "no" }>checked<{elseif "sale_now"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                 <div class="form-group">
                 <label class="checkbox">
             	  Diff:
                  <input type="checkbox" name="sale[]" value="sale_diff" <{if $href_change eq "no" }>checked<{elseif "sale_diff"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                 <div class="form-group">
                 <label class="checkbox">
             	  Change:
                  <input type="checkbox" name="sale[]" value="sale_change" <{if $href_change eq "no" }>checked<{elseif "sale_change"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                 <div class="form-group">
                 <label class="checkbox">
             	  Select All:
                  <input type="checkbox" id="all_sale">
                  </label>
                </div>
             </div>
              <div class="col-lg-12 form-inline">
             	Order Commission:
             	<div class="form-group">
             	<label class="checkbox">
             	  History:
                  <input type="checkbox" name="commission[]" value="commission_his" <{if $href_change eq "no" }>checked<{elseif "commission_his"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                <div class="form-group">
                <label class="checkbox">
             	  Now:
                  <input type="checkbox" name="commission[]" value="commission_now" <{if $href_change eq "no" }>checked<{elseif "commission_now"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                 <div class="form-group">
                 <label class="checkbox">
             	  Diff:
                  <input type="checkbox" name="commission[]" value="commission_diff" <{if $href_change eq "no" }>checked<{elseif "commission_diff"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                 <div class="form-group">
                 <label class="checkbox">
             	  Change:
                  <input type="checkbox" name="commission[]" value="commission_change" <{if $href_change eq "no" }>checked<{elseif "commission_change"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                 <div class="form-group">
                 <label class="checkbox">
             	  Select All:
                  <input type="checkbox" id="all_commission">
                  </label>
                </div>
             </div>
             <div class="col-lg-12 form-inline">
             	Order Cr:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
             	<div class="form-group">
             	<label class="checkbox">
             	  History:
                  <input type="checkbox" name="cr[]" value="cr_his" <{if $href_change eq "no" }>checked<{elseif "cr_his"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                <div class="form-group">
                <label class="checkbox">
             	  Now:
                  <input type="checkbox" name="cr[]" value="cr_now" <{if $href_change eq "no" }>checked<{elseif "cr_now"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                 <div class="form-group">
                 <label class="checkbox">
             	  Diff:
                  <input type="checkbox" name="cr[]" value="cr_diff" <{if $href_change eq "no" }>checked<{elseif "cr_diff"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                 <div class="form-group">
                 <label class="checkbox">
             	  Change:
                  <input type="checkbox" name="cr[]" value="cr_change" <{if $href_change eq "no" }>checked<{elseif "cr_change"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                 <div class="form-group">
                 <label class="checkbox">
             	  Select All:
                  <input type="checkbox" id="all_cr">
                  </label>
                </div>
             </div>
               <div class="col-lg-12 form-inline">
             	Order Clicks:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
             	<div class="form-group">
             	<label class="checkbox">
             	  History:
                  <input type="checkbox" name="click[]" value="click_his" <{if $href_change eq "no" }>checked<{elseif "click_his"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                <div class="form-group">
                <label class="checkbox">
             	  Now:
                  <input type="checkbox" name="click[]" value="click_now" <{if $href_change eq "no" }>checked<{elseif "click_now"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                 <div class="form-group">
                 <label class="checkbox">
             	  Diff:
                  <input type="checkbox" name="click[]" value="click_diff" <{if $href_change eq "no" }>checked<{elseif "click_diff"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                 <div class="form-group">
                 <label class="checkbox">
             	  Change:
                  <input type="checkbox" name="click[]" value="click_change" <{if $href_change eq "no" }>checked<{elseif "click_change"|in_array:$origin_colarr}>checked<{/if}>>
                  </label>
                </div>
                <div class="form-group">
                 <label class="checkbox">
             	  Select All:
                  <input type="checkbox" id="all_click">
                  </label>
                </div>
             </div>
            </div>
           
          </div>
        </div>
      </div>
      
        


    </div>
  </div>


  <div class="">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th style="width:5%">Domain</th>
          <th id="choose_num" <{if $href_change eq "no" or $count.num}><{else}>style="display:none"<{/if}> <{if $href_change eq "no" }>colspan="4"<{else}>colspan="<{$count.num}>"<{/if}> >Order Num</th>
          <th id="choose_sale"<{if $href_change eq "no" or $count.sale}><{else}>style="display:none"<{/if}> <{if $href_change eq "no" }>colspan="4"<{else}>colspan="<{$count.sale}>"<{/if}>>Order Sale</th>
          <th id="choose_commission"<{if $href_change eq "no" or $count.commission}><{else}>style="display:none"<{/if}> <{if $href_change eq "no" }>colspan="4"<{else}>colspan="<{$count.commission}>"<{/if}> >Order Commission</th>
          <th id="choose_cr"<{if $href_change eq "no" or $count.cr}><{else}>style="display:none"<{/if}> <{if $href_change eq "no" }>colspan="4"<{else}>colspan="<{$count.cr}>"<{/if}>>Order CR</th>
          <th id="choose_click"<{if $href_change eq "no" or $count.click}><{else}>style="display:none"<{/if}> <{if $href_change eq "no" }>colspan="4"<{else}>colspan="<{$count.click}>"<{/if}>>Order Clicks</th>
        </tr>
        <tr>
          <th></th>
          <th id="num_his">History</th>
          <th id="num_now">Now</th>
          <th id="num_diff">Diff</th>
          <th id="num_change">Change</th>
          <th id="sale_his">History</th>
          <th id="sale_now">Now</th>
          <th id="sale_diff">Diff</th>
          <th id="sale_change">Change</th>
          <th id="commission_his">History</th>
          <th id="commission_now">Now</th>
          <th id="commission_diff">Diff</th>
          <th id="commission_change">Change</th>
          <th id="cr_his">History</th>
          <th id="cr_now">Now</th>
          <th id="cr_diff">Diff</th>
		  <th id="cr_change">change</th>
		  <th id="click_his">History</th>
          <th id="click_now">Now</th>
          <th id="click_diff">Diff</th>
		  <th id="click_change">change</th>
        </tr>
        <tr>
          <th>Total</th>
          <th id="num_his_total"><{$transactionTotal.his_ordernum|number_format:'0':'.':','}></th>
          <th id="num_now_total"><{$transactionTotal.now_ordernum|number_format:'0':'.':','}></th>
          <th id="num_diff_total"><{$transactionTotal.diff_ordernum|number_format:'0':'.':','}></th>
          <th id="num_change_total" <{if $transactionTotal.per_ordernum > 20 }>style="color:red;font-weight:900;"<{ elseif $transactionTotal.per_ordernum < -20}>style="color:green;font-weight:900;"<{/if}>>
            <{$transactionTotal.per_ordernum|number_format:'0':'.':','}>%
          </th>
          <th id="sale_his_total">$<{$transactionTotal.his_ordersales|number_format:'2':'.':','}></th>
          <th id="sale_now_total">$<{$transactionTotal.now_ordersales|number_format:'2':'.':','}></th>
          <th id="sale_diff_total">$<{$transactionTotal.diff_ordersales|number_format:'2':'.':','}></th>
          <th id="sale_change_total" <{if $transactionTotal.per_ordersales > 20 }>style="color:red;font-weight:900;"<{ elseif $transactionTotal.per_ordersales < -20}>style="color:green;font-weight:900;"<{/if}>><{$transactionTotal.per_ordersales|number_format:'2':'.':','}>%</th>
          <th id="commission_his_total">$<{$transactionTotal.his_commission|number_format:'2':'.':','}></th>
          <th id="commission_now_total">$<{$transactionTotal.now_commission|number_format:'2':'.':','}></th>
          <th id="commission_diff_total">$<{$transactionTotal.diff_commission|number_format:'2':'.':','}></th>
          <th id="commission_change_total" <{if $transactionTotal.per_commission > 20 }>style="color:red;font-weight:900;"<{ elseif $transactionTotal.per_commission < -20}>style="color:green;font-weight:900;"<{/if}>><{$transactionTotal.per_commission|number_format:'2':'.':','}>%</th>
          <th id="cr_his_total"><{$transactionTotal.his_cr|number_format:'2':'.':','}>%</th>
          <th id="cr_now_total"><{$transactionTotal.now_cr|number_format:'2':'.':','}>%</th>
          <th id="cr_diff_total"><{$transactionTotal.diff_cr|number_format:'2':'.':','}></th>
          <th id="cr_change_total"><{$transactionTotal.per_cr|number_format:'2':'.':','}>%</th>
          <th id="click_his_total"><{$transactionTotal.his_click}></th>
          <th id="click_now_total"><{$transactionTotal.now_click}></th>
          <th id="click_diff_total"><{$transactionTotal.diff_click}></th>
          <th id="click_change_total"><{$transactionTotal.per_cr|number_format:'2':'.':','}>%</th>
        </tr>
      </thead>

      <tbody>
        <{foreach from=$transactionData item=tran}>
        <tr>
          <td><a style="cursor:pointer" class="publisher"><{$tran.name}></a></td>
          <td class="num_his_data"><{$tran.his_ordernum|number_format:'0':'.':','}></td>
          <td class="num_now_data"><{$tran.now_ordernum|number_format:'0':'.':','}></td>
          <td class="num_diff_data"><{$tran.diff_ordernum|number_format:'0':'.':','}></td>
          <td class="num_change_data" <{if $tran.per_ordernum > 20 }>style="color:red;font-weight:900;"<{ elseif $tran.per_ordernum < -20}>style="color:green;font-weight:900;"<{/if}>>
            <{$tran.per_ordernum|number_format:'0':'.':','}>%
          </td>
          <td class="sale_his_data">$<{$tran.his_ordersales|number_format:'2':'.':','}></td>
          <td class="sale_now_data">$<{$tran.now_ordersales|number_format:'2':'.':','}></td>
          <td class="sale_diff_data">$<{$tran.diff_ordersales|number_format:'2':'.':','}></td>
          <td class="sale_change_data" <{if $tran.per_ordersales > 20 }>style="color:red;font-weight:900;"<{ elseif $tran.per_ordersales < -20}>style="color:green;font-weight:900;"<{/if}>><{$tran.per_ordersales|number_format:'2':'.':','}>%</td>
          <td class="commission_his_data">$<{$tran.his_commission|number_format:'2':'.':','}></td>
          <td class="commission_now_data">$<{$tran.now_commission|number_format:'2':'.':','}></td>
          <td class="commission_diff_data">$<{$tran.diff_commission|number_format:'2':'.':','}></td>
          <td class="commission_change_data" <{if $tran.per_commission > 20 }>style="color:red;font-weight:900;"<{ elseif $tran.per_commission < -20}>style="color:green;font-weight:900;"<{/if}>><{$tran.per_commission|number_format:'2':'.':','}>%</td>
          <td class="cr_his_data"><{$tran.his_cr|number_format:'2':'.':','}>%</td>
          <td class="cr_now_data"><{$tran.now_cr|number_format:'2':'.':','}>%</td>
          <td class="cr_diff_data"><{$tran.diff_cr|number_format:'2':'.':','}></td>
          <td class="cr_change_data" <{if $tran.per_cr > 0 }>style="color:red;font-weight:900;"<{ elseif $tran.per_cr < 0}>style="color:green;font-weight:900;"<{/if}>><{$tran.per_cr|number_format:'2':'.':','}>%</td>
          <td class="click_his_data"><{$tran.his_click}></td>
          <td class="click_now_data"><{$tran.now_click}></td>
          <td class="click_diff_data"><{$tran.diff_click}></td>
          <td class="click_change_data" <{if $tran.per_click > 0 }>style="color:red;font-weight:900;"<{ elseif $tran.per_click < 0}>style="color:green;font-weight:900;"<{/if}>><{$tran.per_click|number_format:'2':'.':','}>%</td>
        </tr>
        <{/foreach}>
      </tbody>

    </table>
<div id="pagehtml" ><{$pageHtml}></div>
  </div>
</div>



<script>
(function(){
  $('.tip').keyup(function(){
    var ipt = this;
    var keywords = $(this).val();
    var url = '<{$smarty.const.BASE_URL}>/process.php';
    var ajaxdata = 'act=tip_site&keywords='+keywords;

    if(!keywords.match(/[^\s]{1,}/)){
      return;
    }

    $.ajax({
      type:"post",
      url:"<{$smarty.const.BASE_URL}>/process.php",
      data:ajaxdata,
      success: function(req){
        var html_tip = '<ul class="dropdown-menu" >';
        var arr = req.split('|');
        for(var i in arr){
          html_tip = html_tip+'<li><a href="javascript:void(0);">'+arr[i]+'</a></li>';
        }
        var html_tip = html_tip+'</ul>';


        if($(ipt).parent().find('ul')){
          $(ipt).parent().find('ul').remove();
        }

        $(ipt).parent().append(html_tip);

        load_tip($(ipt).parent().find('ul'));
      }
    });

   
  });

  
  
  
  
  
  
  if("<{$href_change}>" == "yes"){
	  var td = <{$td}>;
	  var colarr = <{$colarr}>; 
	$.each(td,function(n,val){
		  if($.inArray(val+"_his",colarr) == '-1'){
			  $('#'+val+'_his').css("display","none");
			  $('#'+val+'_his_total').css("display","none");
			  $('.'+val+'_his_data').css("display","none");
		  }
		  if($.inArray(val+"_now",colarr) == '-1'){
			  $('#'+val+'_now').css("display","none");
			  $('#'+val+'_now_total').css("display","none");
			  $('.'+val+'_now_data').css("display","none");
		  }
		  if($.inArray(val+"_diff",colarr) == '-1'){
			  $('#'+val+'_diff').css("display","none");
			  $('#'+val+'_diff_total').css("display","none");
			  $('.'+val+'_diff_data').css("display","none");
		  }
		  if($.inArray(val+"_change",colarr) == '-1'){
			  $('#'+val+'_change').css("display","none");
			  $('#'+val+'_change_total').css("display","none");
			  $('.'+val+'_change_data').css("display","none");
		  }
		  
	});
  }
  
  
  
  
  
  
  
  
  
  
  
  
})();

function load_tip(obj){
  $(obj).css('display','block');
  $(obj).find('a').click(function(){
    $(obj).prev().val($(this).html());
    $(obj).remove();
  });
}

$('#colume').click(function(){                           //控制colume选择框的显示与隐藏
	if($('#colume_list').css("display") == "none"){
		$('#colume_list').css("display","block");
	}else{
		$('#colume_list').css("display","none");
	}
	$('#choose').val('yes');
});




$('#colume_list input:checkbox').click(function(){
	  var opt = $(this);
	  var key = $(this).val();
	  var list = (key.split("_"))[0];
	  var td = <{$td}>;
	  
	  $.each(td,function(n,v){                    //if判断用于改变colspan的值
		  if(list == v){                         
			 // console.info(opt);
				var length = $(opt.parent().parent().parent()).find("input:checked").length;         //num行中，所有被选中的input的个数
				//alert (length);
				if (length != 0){
					$("#choose_"+v).css("display","")
					$("#choose_"+v).attr("colspan",length);
				}else{
					$("#choose_"+v).css("display","none")
				}
			  }	  
	  });
	  

	  

	  
	  if(!$(this).is(":checked")){
		  $('#'+key).css("display","none");
		  $('#'+key+'_total').css("display","none");
		  $('.'+key+'_data').css("display","none");
	  }else{
		  $('#'+key).css("display","");
		  $('#'+key+'_total').css("display","");
		  $('.'+key+'_data').css("display","");
	  }


});


//----------------------------------------------------每点击一次分页栏，都会更新<{$pagehtml}>中所有<a>标签的href属性-----------------------------------------------

$($('#pagehtml').find('a')).click(function(){
	var urlstr = "";
	$($('#colume_list').find("input:checked")).each(function(){
		urlstr = urlstr+"|"+$(this).val();

	});

	$($('#pagehtml').find('a')).each(function(){                      //将分页中的所有相关<a>标签的href都加上checked框的选项值
		var newurl = $(this).attr("href")+"&colstr="+urlstr.substr(1);
		$(this).attr("href",newurl);
	});

});


//--------------------------------------------------动态显示某个domain对应的各个publisher的数据--------------------------------------------------------------------
$('.publisher').click(function(){
	var ipt = $(this);
	var domain = $(this).html();
	var his_from = $('#his_from').val();
	var his_to = $('#his_to').val();
	var now_from = $('#now_from').val();
	var now_to = $('#now_to').val();
	var ajaxdata = 'act=tip_history_domain_publisher&his_from='+his_from+'&his_to='+his_to+'&now_from='+now_from+'&now_to='+now_to+'&domain='+domain;
	
	
	
	
	
	

	var html = '<tr name="tip" style="background-color:#A0E8FF"><td> Loading...... </td></tr>';
	if($($($(ipt).parent().parent().parent()).find("tr")).is('[name="alias"]')){
		$($($(ipt).parent().parent().parent()).find("tr[name='alias']")).remove();
	}else{
		if(!$($($(ipt).parent().parent().parent()).find("tr")).is('[name="tip"]')){
			$(ipt).parent().parent().after(html);
		}

	    $.ajax({
	        type:"post",
	        dataType:"json",
	        url:"<{$smarty.const.BASE_URL}>/process.php",
	        data:ajaxdata,
	        success: function(req){//req是二维数组
	        	
	        	$($($(ipt).parent().parent().parent()).find("tr[name='tip']")).remove();
	        	
	        	
	        	
	        	
	        	
	        	var html = "";
				//console.info(req);
				var tip = "";
	           	for(var i in req){
	           		
	           		
	        	  	var html = html+'<tr name="alias" style="background-color:#A0E8FF" ><td>'+req[i].name+'</td><td>'+req[i].his_ordernum+'</td><td>'+req[i].now_ordernum+'</td><td>'+req[i].diff_ordernum+'</td><td>'+parseFloat(req[i].per_ordernum).toFixed(2)+'%</td><td>$'+parseFloat(req[i].his_ordersales).toFixed(2)+'</td><td>$'+parseFloat(req[i].now_ordersales).toFixed(2)+'</td><td>$'+parseFloat(req[i].diff_ordersales).toFixed(2)+'</td><td>'+parseFloat(req[i].per_ordersales).toFixed(2)+'%</td><td>$'+parseFloat(req[i].his_commission).toFixed(2)+'</td><td>$'+parseFloat(req[i].now_commission).toFixed(2)+'</td><td>$'+parseFloat(req[i].diff_commission).toFixed(2)+'</td><td>'+parseFloat(req[i].per_commission).toFixed(2)+'%</td><td>'+parseFloat(req[i].his_cr).toFixed(2)+'%</td><td>'+parseFloat(req[i].now_cr).toFixed(2)+'%</td><td>'+parseFloat(req[i].diff_cr).toFixed(2)+'</td><td>'+parseFloat(req[i].per_cr).toFixed(2)+'%</td><td>'+req[i].his_click+'</td><td>'+req[i].now_click+'</td><td>'+req[i].diff_click+'</td><td>'+req[i].per_click+'%</td></tr>';
	           	}
	           
	        	var html = '<tr><table>'+html+'</table></tr>'
	        	if($($($(ipt).parent().parent().parent()).find("tr")).is('[name="alias"]')){
	        		$($($(ipt).parent().parent().parent()).find("tr[name='alias']")).remove();
	        	}else{
	        		$($($(ipt).parent().parent().parent()).find("tr[name='tip']")).remove();
	        		$(ipt).parent().parent().after(html);
	        	} 
	        }
	      });
	}
	

});

//---------------------------------------------------------------------全选按钮-----------------------------------------------------------------------
colume = <{$colume}>;
td = <{$td}>;

$.each(td,function(n,v){

	

	$('#all_'+v).click(function(){
		if($(this).is(":checked")){
			$($($(this).parent().parent().parent()).find('input')).prop('checked',true);
			$('#choose_'+v).css('display','');
			$.each(colume,function(n,val){
				$('#'+v+'_'+val).css('display','');
				$('#'+v+'_'+val+'_total').css('display','');
				$('.'+v+'_'+val+'_data').css('display','');
				
			});

		}else{
			$($($(this).parent().parent().parent()).find('input')).prop('checked',false);
			$('#choose_'+v).css('display','none');
			$.each(colume,function(n,val){
				$('#'+v+'_'+val).css('display','none');
				$('#'+v+'_'+val+'_total').css('display','none');
				$('.'+v+'_'+val+'_data').css('display','none');
				
			});

		}
		
	});
	
});

//-----------------------------------------------------------------导出excel--------------------------------------------------------------------------------
$('#excel').click(function(){
var his_from = $('#his_from').val();
var his_to = $('#his_to').val();
var now_from = $('#now_from').val();
var now_to = $('#now_to').val();
var pid = $('#pid').val();
var orderby = $('#orderby option:selected').val();
var order = $('#order option:selected').val();
var minorder = $('#minorder').val();
var checked = new Array();

var td = <{$td}>;
var colume = <{$colume}>;
$.each(td,function(n,val){
	$.each(colume,function(n,v){
		if($('input[value='+val+'_'+v+']').is(':checked')){
			checked.push($('input[value='+val+'_'+v+']').val());
			//console.info(checked);	
		}
	});

});

var checked_str = checked.join('|');
console.info(checked_str);

window.location = 'excel.php?his_from='+his_from+'&his_to='+his_to+'&now_from='+now_from+'&now_to='+now_to+'&pid='+pid+'&orderby='+orderby+'&order='+order+'&minorder='+minorder+'&checked_str='+checked_str;

});

</script>

<{include file="b_block_footer.html"}>