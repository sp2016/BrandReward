<{include file="b_block_header.html"}>
<{include file="b_block_banner.html"}>
<{include file="b_generate_link_modal.html"}>
<style type="text/css">
    .multiselect {
        text-align: left;
    }
    .multiselect b.caret {
        position: absolute;
        top: 14px;
        right: 8px;
    }
    .drop{
        padding: 3px 20px;
        clear: both;
        font-weight: normal;
        line-height: 1.42857143;
        color: #333;
        white-space: nowrap;
    }
    .multiselect-group {
        font-weight: bold;
        text-decoration: underline;
    }
    .form-inline .form-group{
		margin-bottom: 15px;
    }
	.dropdown-menu > li label.checkbox{
	    display: block;
	    padding: 3px 20px;
	    clear: both;
	    line-height: 1.42857143;
	    color: #333;
	    white-space: nowrap;
	    cursor: pointer;
    }
	.dropdown-menu > li label.checkbox:hover{
	    color: rgb(183,184,205);
    }
</style>
<div>
    <div class="container-fluid title-container" style="margin-top:30px;">
        <div class="title-h1" style="text-align:center;margin-bottom:30px;"><h1>Promotions</h1></div>

<{if $level=='TIER11'}>
        <h3 style="text-align: center;color: grey;">TOP Promotions</h3>
        <div class="m search-tier11">
            <ul class="bxslider">
                <{foreach from=$topCilckPromotions item=store}>
                <li class="als-item">
                    <table width="100%" style="table-layout: fixed;" >
                        <tr>
                            <td rowspan="2" style="width: 160px">
                                <img src="img/advertiser/41731.png" />
                            </td>
                            <td colspan="2" style="text-align: left;width: 300px;">
                                <{$store.StoreName}>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" style="text-align: left">
                                <div style="position: relative;">
                                    <input type="button" class="btn b-primary copydata" value="Copy Link" data-val="<{$store.AffUrl}>"/>
                                </div>
                            </td>
                        </tr>
                        <tr style="display:block; margin:3px 0;">
                            <td colspan="2" style="text-align: left">
                                Expire Time:<{$store.EndDate}>
                            </td>
                        </tr>
                        <{if $store.type=='Coupon'}>
                        <tr>
                            <td style="text-align: left">
                                <div style="position: relative;">
                                    <input type="button" class="copydata" value="Click To Copy Coupon Code" data-val="<{$store.CouponCode}>" style="border: none;background-color: white;padding-left: 0;"/>
                                </div>
                            </td>
                        </tr>
                        <{/if}>
                        <tr>
                            <td colspan="3" style="text-overflow: ellipsis;white-space: nowrap;overflow: hidden;">
                                Title:<{$store.Title}>
                            </td>
                        </tr>
                        <{if $store.Desc != ''}>
                        <tr>
                            <td colspan="3" style="text-overflow: ellipsis;white-space: nowrap;overflow: hidden;">
                                Description:<{$store.Desc}>
                            </td>
                        </tr>
                        <{/if}>
                    </table>
                </li>
                <{/foreach}>
            </ul>
        </div>
<{/if}>
        <div class="row search-form" style="padding:20px 0;">

           	<div class="overlay" style="display:none;"></div>
            <div class="col-lg-12 filter">
                <div class="panel panel-default">
                    <div class="panel-heading">Search
                    	<a href="#" class="back"></a>
                        <a href="#" class="close"></a>
                    </div>
                    <div class="panel-body">
                        <form id="form_content_search">
                            <!--<input type="hidden" name="p" value="1" />-->
                            <div class="row">
                                <div class="form-inline">
                                    <div class="col-lg-12 ">
                                        <div class="form-group dpm" style="position:relative;">
                                            Advertiser:
                                            <!-- <div class="input-group">
                                            	<div class="input-group-btn">
											        <button style="width:80px" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span id="keyword_type_txt"><{$search.keyword_type}></span> <span class="caret"></span></button>
											        <ul class="dropdown-menu ad_search_type">
											          <li class="type_Like"><a href="javascript:void(0)">Like</a></li>
											          <li class="type_Equal"><a href="javascript:void(0)">Equal</a></li>
											        </ul>
										       </div>
										       <input type="hidden" id="keyword_type" name="keyword_type" value="<{$search.keyword_type}>">
										    </div> -->
										       <input type="text" style="width: 200px;" name="keyword" data-type="advertiser" class="form-control advertiser" placeholder="e.g Ebay, Amazon, etc." value="<{$search.keyword}>" aria-label="...">
                                        </div>
                                        <!-- <div class="form-group opm" style="position:relative;">
                                            &nbsp;Domain:
                                            <input type="text" style="width: 330px;" name="domain" class="form-control domain"  data-type="domain" value="<{$search.domain}>">
                                        </div> -->
                                        <div class="form-group">
                                            &nbsp;Keyword Search:
                                            <input type="text" style="width: 200px;" name="keywords" class="form-control" value="<{$search.keywords}>" placeholder="enter keyword">
                                        </div>
                                        <div class="form-group">
	                                        &nbsp;Choose Country:
	                                        <select name="country" class="form-control" style="width:120px">
	                                            <option value="">All</option>
	                                            <{foreach from=$countryArr key=k item=c}>
	                                            <option value="<{$c}>" <{if isset($search.country) and $search.country eq $c}>selected="selected"<{/if}>><{$k}></option>
	                                            <{/foreach}>
	                                        </select>
	                                    </div>
	                                    <div class="form-group">
	                                    	<span class="date-wrap">Promotion Period:</span>
	                                        <input type="text" name="start" class="form-control datepicker" style="width:150px" placeholder="Start Time" value="<{$search.start}>">
	                                        <input type="text" name="end" class="form-control datepicker" style="width:150px" placeholder="End Time" value="<{$search.end}>">
                                        </div>
                                        <div class="form-group">
                                            &nbsp;Type:
                                            <select name="type" class="form-control" style="width:120px">
                                                <option value="">All</option>
                                                <option value="Coupon"  <{if isset($search.type) and $search.type eq Coupon}>selected="selected"<{/if}>>Coupon</option>
                                                <option value="Promotion" <{if isset($search.type) and $search.type eq Promotion}>selected="selected"<{/if}>>Deal</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
	                                        <input type="hidden" value="<{$search.categories}>" name="categories" class="categories">
	                                        <div class="btn-group">
	                                            <button type="button"  class="multiselect dropdown-toggle btn btn-default" data-toggle="dropdown" title="Category" >Category&nbsp;<b class="caret"></b></button>
	                                            <ul class="multiselect-container dropdown-menu" onclick="event.stopPropagation();" style="overflow:scroll;min-height:150px;min-width: 260px;">
	                                                <li style="margin-bottom: 5px;margin-top: 1px;padding:0 20px;">
	                                                    <!-- <a href="javascript:void(0);" style="display: inline;margin:0 auto; padding:0;"><span class="label label-info" onclick="select_opt('all')">Select All</span></a>
	                                                    <a href="javascript:void(0);" style="display: inline;margin:0 auto; padding:0;"><span class="label label-warning" onclick="select_opt('none')">Deselect All</span></a> -->
	                                                    <a href="javascript:void(0);" style="display: inline;margin:0 auto; padding:0;"><span class="label label-info" onclick="select_opt('close')">Close</span></a>
	                                                </li>
	                                                <{foreach item=cate key=id from=$category}>
	                                                <li><label class="checkbox"><input type="checkbox"
	                                                    <{if $sel_cate }>
	                                                    <{foreach from=$sel_cate item=sc}>
	                                                    <{if $sc == $id}> checked <{/if}>
	                                                    <{/foreach}>
	                                                    <{/if}>
	                                                    class="category" id="<{$id}>" value="<{$id}>"> <{$cate}></label></li>
	                                                <{/foreach}>
	                                            </ul>
	                                        </div>
	                                    </div>
                                        <div class="form-group">
                                            &nbsp;Language:
                                            <select name="language" class="form-control" style="width:120px">
                                                <option value="">All</option>
                                                <option value="en"  <{if isset($search.language) and $search.language eq 'en'}>selected="selected"<{/if}>>English</option>
                                                <option value="fr" <{if isset($search.language) and $search.language eq 'fr'}>selected="selected"<{/if}>>French</option>
                                                <option value="de" <{if isset($search.language) and $search.language eq 'de'}>selected="selected"<{/if}>>German</option>
                                                <option value="it" <{if isset($search.language) and $search.language eq 'it'}>selected="selected"<{/if}>>Italian</option>
                                                <option value="nl" <{if isset($search.language) and $search.language eq 'nl'}>selected="selected"<{/if}>>Dutch</option>
                                                <option value="es" <{if isset($search.language) and $search.language eq 'es'}>selected="selected"<{/if}>>Spanish</option>
                                                <option value="pt" <{if isset($search.language) and $search.language eq 'pt'}>selected="selected"<{/if}>>Portuguese</option>
                                                <option value="se" <{if isset($search.language) and $search.language eq 'se'}>selected="selected"<{/if}>>Swedish</option>
                                                <option value="ru" <{if isset($search.language) and $search.language eq 'ru'}>selected="selected"<{/if}>>Russian</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                    	<div class="form-group" style="float:left;padding-left: 72px;">
                                        	<div class="checkbox">
                                        		<label style="color: rgb(247,150,70);font-style:oblique">
		                                            <input style="margin-top: 2px;" type="checkbox" name="chk" value="1" <{if isset($search.chk) and $search.chk eq 1}>checked="checked"<{/if}>>
		                                        	Favorite Advertisers
                                        		</label>
                                        	</div>
                                        </div>
                                        <div class="form-group" style="float:right;padding-right: 110px;">
                                            <input type="submit" class="btn b-primary" value="Search">
                                            <input type="button" class="btn b-primary" id="download" value="Download">
                                        </div>
                                        <!-- <div class="form-group dpm">
                                            <font color="white">Advertiser</font>
                                            <select  class="form-control sval" style="width:350px;text-align: center;margin-left: 3px;">
                                                <option value="0" style="color:#CCCCCC">Advertiser Search History</option>
                                                <{foreach from=$adv item=k}>
                                                <option value="<{$k.svalue}>"><{$k.svalue}></option>
                                                <{/foreach}>
                                            </select>
                                        </div>
                                        <div class="form-group opm" style="position:relative;">
                                            <font color="white">Domain</font>
                                            <select class="form-control dval" style="width:330px;text-align: center;margin-left: 9px;">
                                                <option value="0" style="color:#CCCCCC">Domain Search History</option>
                                                <{foreach from=$dom item=k}>
                                                <option value="<{$k.svalue}>"><{$k.svalue}></option>
                                                <{/foreach}>
                                            </select>
                                        </div> -->
                                        <!-- <div class="form-group">
                                            &nbsp;&nbsp;&nbsp;Promotions Period:
                                            <select name="filter" class="form-control" style="width:120px">
                                                <option value="">All</option>
                                                <option value="current"  <{if isset($search.filter) and $search.filter eq current}>selected="selected"<{/if}>>current</option>
                                                <option value="upcoming" <{if isset($search.filter) and $search.filter eq upcoming}>selected="selected"<{/if}>>upcoming</option>
                                            </select>
                                        </div> -->
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-lg-12 promolist">
                <div class="panel panel-default">
                    <div class="panel-heading" style="height: 55px;line-height: 34px;">Promotions
	                    <a href="#" class="show_filter"></a>
	                    <input type="button" style="float:right" class="btn b-primary" id="generatelink" value="Promotion API">
                    </div>
                    <div class="panel-body">
                        <table class="table table-striped table-hover">
                            <thead>
                            <tr>
                                <input type="hidden" value="<{$group}>" class="gp">
                                <th style="padding-bottom: 13px;width: 10%;">Advertiser</th>
                                <th style="padding-bottom: 13px;width: 20%;"> Title </th>
                                <th style="padding-bottom: 13px;width: 10%;">Coupon Code</th>
                                <th style="padding-bottom: 13px;width: 10%;">Commission Value</th>
                                <th style="padding-bottom: 13px;width: 30%;">Description</th>
                                <th class="StartDate" style="width: 10%;">Start Date<a class="pa" data-type="desc" data-name="StartDate" href="javascript:void(0)"><img src="img/desc.png" style="margin-bottom: 10px;"></a></th>
                                <th class="EndDate" style="width: 10%;">End Date <a class="pa" data-type="desc" data-name="EndDate" href="javascript:void(0)"><img src="img/desc.png" style="margin-bottom: 10px;"></a></th>
                                <{*<th class="LastUpdateTime" width=300px>Last Update Time <a class="pa" data-type="desc" data-name="LastUpdateTime" href="javascript:void(0)"><img src="img/desc.png" style="margin-bottom: 10px;"></a></th>*}>
                            </tr>
                            </thead>
                            <{foreach item=feed from=$content}>
                            <tr>
                                <td class="name" rowspan=2>
                                    <input type="hidden" ID="<{$feed.ID}>"><{$feed.Advertiser_Name}>
                                </td>
                                <td class="title"><{$feed.Title}></td>
                                <td class="code">
                                	<span>Coupon Code:</span>
                                	<{$feed.CouponCode}>
                               	</td>
                               	<td class="range">
                                	<span>Commission Value:</span>
                                	<{$feed.CommissionRange}>
                                </td>
                                <td class="desc">
                                	<span>Description:</span>
                                	<{$feed.Desc}>
                               	</td>
                                <!-- <td><{if $feed.CommissionUsed == '0'}>other<{else}><{if $feed.CommissionType == 'Value'}><{if $domain.CommissionCurrency != ''}><{$domain.CommissionCurrency}><{else}>USD<{/if}><{$feed.CommissionUsed}><{else}><{$feed.CommissionUsed}>%<{/if}><{/if}></td> -->
                                <td class="start"><{$feed.StartTime}></td>
                                <td class="expire"><{$feed.ExpireTime}></td>
                                <{*<td class="update"><{$feed.LastUpdateTime}></td>*}>
                            </tr>
                            <tr>
                                <td class="copy" colspan=20>
                                    <div style="position: relative;">
                                        <input type="button" class="btn b-primary copydata" value="Copy Link" data-clipboard-text='<{$feed.LinkUrl}>'>
                                        <{if $feed.PPC == 3}>
                                        <input type="button" class="btn b-primary copydata" value="Copy PPC Link" data-clipboard-text='<{$feed.LinkUrl}>&ppc=1'>
                                        <{/if}>
                                        <span style="color: #7A80DD;word-wrap:break-word; word-break:break-all;display: inline-block;"><{$feed.LinkUrl}></span>
                                    </font>
                                    </div></td>
                            </tr>
                            <{/foreach}>
                        </table>
                        <{$pageHtml}>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <script type="text/javascript">
    
	    /* $('.ad_search_type li').on('click', function(e) {
	    	$("#keyword_type_txt").text($(this).text());
	    	$("#keyword_type").val($(this).text());
	    })
    	var searchType;
    	if("<{$search.keyword_type}>" == "Equal"){
    		searchType = "Equal";
    	}else{
    		searchType = "Like";
    	}
    	$(".type_"+searchType).trigger('click'); */
    	
        //复制到剪切板
        /* $('.copydata').zclip({
            path: "js/ZeroClipboard.swf",
            copy:function(){
                return $(this).data('val');
            }
        }); */
    	
   		var clipboard = new Clipboard('.copydata');
           clipboard.on('success', function(e) {
             alert("Copied text to clipboard:\r\n"+e.text);
             e.clearSelection();
           });
           clipboard.on('error', function(e) {
             alert('Failed,copy text manually!');
        });

        //搜索记录
        $('.sval').bind('change',function(){
          if($(this).val() !=0 ){
              $('.advertiser').val($(this).val());
              $('.sval option').eq(0).prop('selected',true);
          }
        })
        $('.dval').bind('click',function(){
            if($(this).val() !=0 ){
                $('.domain').val($(this).val());
                $('.dval option').eq(0).prop('selected',true);
            }
        })
        $('.addfav').bind('click',function(){
            var fid = $(this).data('id');
            var type = $(this).attr('data-type');
            var aname = $(this).data('name');
            $.ajax({
                type:"post",
                url:"b_content_new.php",
                data:{'fid':fid,'aname':aname,'type':type},
                async:false,
                success: function(res){
                    if(res == 1){
                        var cls = ".fav"+fid;
                        $(cls).find('span').removeClass('glyphicon-plus-sign');
                        $(cls).find('span').addClass('glyphicon-ok-sign');
                        $(cls).find('span').removeAttr('style');
                        $(cls).find('span').css('font-size','24px');
                        $(cls).find('span').css('color','#7A80DD');
                        $(cls).attr('data-type','1');
                    }else{
                        var cls = ".fav"+fid;
                        $(cls).find('span').removeClass('glyphicon-ok-sign');
                        $(cls).find('span').addClass('glyphicon-plus-sign');
                        $(cls).find('span').removeAttr('style');
                        $(cls).find('span').css('font-size','24px');
                        $(cls).find('span').css('color','#627491');
                        $(cls).attr('data-type','0');
                    }
                }
            });
        });
        //排序图标变换
        var gp = $('.gp').val();
        if(gp != ''){
            var val = gp.split('-');
            if(val[0] == 'StartDate'){
                var text = '<font color="#7A80DD">Start Date</font>';
            }else if(val[0] == 'EndDate'){
                var text = '<font color="#7A80DD">End Date</font>';
            }else {
                var text = '<font color="#7A80DD">Last Change Time</font>';
            }
            if(val[1] == 'desc'){
                var html = text+'<a class="pa '+val[0]+'" data-type="asc" data-name="'+val[0]+'" href="javascript:void(0)" ><img src="img/asc.png"></a>';
                $('.'+val[0]+'').css('padding-bottom','13px');
            }else {
                var html = text+'<a class="pa '+val[0]+'" data-type="desc" data-name="'+val[0]+'" href="javascript:void(0)" ><img src="img/desc.png" style="margin-bottom: 10px;"></a>';
            }
            $('.'+val[0]+'').html(html);
        }

        function get_category(){
            var cate='';
            var cc =$("input[class='category']:checked");
            for(var i=0;i<cc.length;i++){
                if(cc[i].checked){
                    cate += cc[i].value+',';
                }
            }
            cate=cate.substring(0,cate.length-1);
            $('.categories').val(cate);
        }

        var category = $(".categories").val().split(',');
        for(var i=0;i<category.length;i++){
            $('.category_'+category[i]).attr('checked','checked');
        }

        $(".category").change(function () {
            get_category();
        });

        $('#download').click(function(){
            var value = $('#form_content_search').serialize();
            window.open('<{$smarty.const.BASE_URL}>/process.php'+'?act=downloadcontentnew&'+value);
        });

        $('.multiselect-group').click(function(){
            var pid = $(this).attr('id');
            if($(this).attr('status')=='no'){
                $('.category_'+pid).prop('checked','true');
                $(this).attr('status','yes');
            }else{
                $('.category_'+pid).removeAttr('checked');
                $(this).attr('status','no');
            }
            get_category();
        });

        function select_opt(val)
        {
            switch (val)
            {
                case 'all':
                    $('.category').prop('checked',true);
                    break;
                case 'none':
                    $('.category').prop('checked',false);
                    break;
                case 'close':
                    $('.btn-group').removeClass('open');
                    break;
                default:
                    break;
            }
            get_category();
        }

        $('.pa').click(function(){

            var name = $(this).data('name');
            var type = $(this).data('type');
            var text = 'group'+'='+name+'&sc'+'='+type;
            var url = window.location.search;
            if( url != ''){
                if(url.indexOf('group') > 1){
                    var news = url.substr(0,url.indexOf('group'));
                    var text1 = news+'&'+text;
                    location.href = 'b_content_new.php'+text1;
                }else{
                    location.href = 'b_content_new.php'+url+'&'+text;
                }
            }else{
                var url = 'b_content_new.php?&'+text;
                location.href = url;
            }
        });

        $('.bxslider').bxSlider({
            minSlides: 1,
            maxSlides: 3,
            slideWidth: 460,
            auto: true,
            pause:3000,
            autoHover:true,
            pager:true,
        });
        
        $("#generatelink").click(function(){
        	generate_link();
        	$("#generateLink").modal();
        });
        
        /* $('#generateLink').on('shown.bs.modal', function () {
        	if($("#copyApiUrl").siblings('div').length==0){
        		$('#copyApiUrl').zclip({
                    path: "js/ZeroClipboard.swf",
                    copy:function(){
                        return $("#apiurl").text();
                    }
                });
        	}
     	}) */
        
        $(document).delegate("input:radio[name='outformat']","change",function(){
        	generate_link();
        })
        
        $(document).delegate("#fsite","change",function(){
	    	generate_link();
	    })
        
        function generate_link(){
        	$("#generousLinkLabel").html($("#generatelink").val());
        	var fsite = $("#fsite").val();
        	var apiurl = "<{$smarty.const.API_URL}>?act=links.content_feed&key="+fsite+"&user=<{$username}>";
        	if($("input[name='chk']").is(':checked')){
        		apiurl+="&favor=1";
        	}else{
        		apiurl+="&favor=0";
        	}
        	apiurl+="&country="+$("select[name='country']").val()+"&contenttype="+$("select[name='type']").val()+"&category=";
        	$('input[class="category"]:checked').each(function(i){
        		if(i>0){
        			apiurl += ",";
        		}
        		apiurl += $(this).val();
           	}); 
        	apiurl+="&language="+$("select[name='language']").val();
        	apiurl+="&outformat="+$("input:radio[name='outformat']:checked").val();
        	$("#apiurl").html(apiurl);
        }
    </script>
    <{include file="b_block_footer.html"}>
